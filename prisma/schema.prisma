generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  publicId  Int       @unique @default(0) // Internal ID visible to Admin
  email     String    @unique
  password  String
  name      String
  avatarUrl String?
  bio       String?
  role      String    @default("ARTIST") // SQLite doesn't support Enums
  tariff    String    @default("BASIC") // BASIC, PREMIUM
  tariffPeriod String @default("MONTHLY") // MONTHLY, YEARLY
  balance   Float     @default(0)
  releases  Release[]
  analytics AnalyticsReport[]
  notifications Notification[]
  financialReports FinancialReport[]
  payoutRequests   PayoutRequest[]
  artistRequests   ArtistRequest[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model FinancialReport {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  quarter   String
  title     String
  amount    Float
  fileUrl   String?
  linkUrl   String?
  createdAt DateTime @default(now())
}

model PayoutRequest {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  amount    Float
  method    String
  details   String
  status    String   @default("PENDING") // PENDING, PAID, REJECTED
  createdAt DateTime @default(now())
}

model ArtistRequest {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String   // EDIT_CARD, TRANSFER_RELEASE, TAKEDOWN
  platform  String?
  description String
  attachmentUrl String?
  artistCardLink String? // Link to the artist card on the platform
  status    String   @default("PENDING") // PENDING, DONE, REJECTED
  createdAt DateTime @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String   // RELEASE, ANALYTICS, FINANCE, NEWS
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model AnalyticsReport {
  id              String           @id @default(cuid())
  artistId        String
  artist          User             @relation(fields: [artistId], references: [id])
  quarter         String           // e.g., "Q4 2024"
  totalStreams    Int
  uniqueListeners Int
  platformStats   String           @default("{}") // JSON: {"Spotify": 100, "Apple": 50}
  countryStats    String           @default("{}") // JSON: {"RU": 100, "US": 50}
  trackStats      TrackAnalytics[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model TrackAnalytics {
  id        String          @id @default(cuid())
  reportId  String
  report    AnalyticsReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  trackId   String
  track     Track           @relation(fields: [trackId], references: [id])
  streams   Int
}

model Release {
  id          String        @id @default(cuid())
  title       String
  version     String?
  type        String // SQLite doesn't support Enums
  genre       String
  instrumental Boolean      @default(false)
  language    String?
  coverUrl    String?
  releaseDate DateTime
  status      String        @default("DRAFT") // SQLite doesn't support Enums
  artistId    String
  artist      User          @relation(fields: [artistId], references: [id])
  mainArtist  String
  featArtists String?       // Stored as comma separated string for simplicity
  comment     String?
  upc         String?
  rejectionReason String?
  promoRequest Boolean      @default(false)
  promoReleaseInfo String?
  promoArtistInfo String?
  promoMarketingInfo String?
  smartLinkSlug String?     @unique
  platformLinks String      @default("{}") // JSON: { spotify: "", apple: "" }
  tracks      Track[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model News {
  id        String   @id @default(cuid())
  title     String
  content   String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Track {
  id           String   @id @default(cuid())
  releaseId    String
  release      Release  @relation(fields: [releaseId], references: [id], onDelete: Cascade)
  position     Int
  title        String
  version      String?
  artists      String?
  mainArtist   String?
  featArtists  String?
  instrumental Boolean  @default(false)
  ffp          Boolean  @default(false) // Free For Profit
  explicit     Boolean  @default(false)
  composer     String
  lyricist     String?
  fileUrl      String?  // URL to the audio file
  analytics    TrackAnalytics[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

// Enums removed for SQLite compatibility